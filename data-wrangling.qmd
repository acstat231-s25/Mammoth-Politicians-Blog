---
title: "Blog Project"
subtitle: "Wrangling"
author: "Rachel, Josh, Sheryl"
date: "2025-04-17"
format: pdf
---


```{r}
#| label: setup
#| include: false

knitr::opts_chunk$set(eval = FALSE, message = FALSE)

# improve digit and NA display 
options(scipen = 1, knitr.kable.NA = '')

# load packages
library(tidyverse)
library(tidytext)
library(dplyr)
library(quanteda)
library(purrr)
library(broom)
#summary statistics - flesch,kincaid,mean sentence.
library(quanteda.textstats)
#topic models
library(topicmodels)
library(ggrepel)

```


```{r}
#| label: import-data

# We starting with the data from our Shiny project
load("raw-data/inaugural_speech_analysis.Rdata")
load("raw-data/inaugural_speeches.Rdata")
load("raw-data/president-names.Rdata")

```

```{r}
#| label: freq-era-wrangling



```





```{r}
#| label: readability-stats(Flesch,Kincaid,meanSentence)

inaug_speeches_all_clean <- inaug_speeches_all_clean |>
  mutate(sentences = nsentence(text))

readability_stats <- textstat_readability(inaug_speeches_all_clean$text, measure = c("Flesch", "Flesch.Kincaid", "meanSentenceLength"))

# check
nrow(readability_stats)
nrow(inaug_speeches_all_clean)

# Merge readability stats with inaug_speeches_all_clean by row
#bind_cols : binds rows in order of df 

inaug_speeches_master <- bind_cols(inaug_speeches_all_clean, readability_stats)

#check
nrow(inaug_speeches_master)
nrow(inaug_words_sentiment)

#left_join uses variables (date, president) as the join key // automatic
inaug_speeches_master <- left_join(inaug_speeches_master, inaug_words_sentiment)




```


```{r}
#| label: clustering


### Flesch-Kincaid vs Sentiment ###
flesch_sentiment <- inaug_speeches_master |>
  select(Flesch, sentiment)

#set seed for reproducibility
set.seed(420)

# Optimal # of clustering is 4-6. VERIFIED.
flesch_sentiment_kmeans4 <- flesch_sentiment |>
  kmeans(centers = 6, nstart = 20)

#add cluster results to original data
inaug_speeches_master <- inaug_speeches_master |>
  mutate(flesch_sentiment_cluster = flesch_sentiment_kmeans4$cluster)




### Flesch-Kincaid vs Sentiment ###
fleschKin_sentiment <- inaug_speeches_master |>
  select(Flesch.Kincaid, sentiment)

# Optimal # of clustering is 4-6. VERIFIED
fleschKin_sentiment_kmeans4 <- fleschKin_sentiment |>
  kmeans(centers = 6, nstart = 20)

#add cluster results to original data
inaug_speeches_master <- inaug_speeches_master |>
  mutate(flesch_kin_sentiment_cluster = fleschKin_sentiment_kmeans4$cluster)

```

```{r}
#| label: elbow-plot

# URGENT NOTE: This elbow plot is used for multiple different charts. JUST SWAP OUT THE DATA SET AND CHANGE THE TITLE.
elbow_plot <- tibble(k = 1:10) |>
  mutate( 
    kmeans_results = purrr::map(k, ~kmeans(flesch_sentiment, centers = .x, nstart=20)),
    glanced = purrr::map(kmeans_results, glance)) |>
    unnest(cols = c(glanced))


# construct elbow plot
ggplot(elbow_plot, aes(x = k, y = tot.withinss)) +
geom_point() +
geom_line() +
scale_x_continuous(breaks = 1:10) +
labs(
  x = "Number of clusters (k)",
  y = "Total within-cluster sum of squares",
  title = "Optimal Clustering: Flesch-Kincaid vs. Sentiment")
```


```{r}
#| label: Plotting-Flesch vs.Sentiment

ggplot(inaug_speeches_master, aes(y = Flesch, x = sentiment)) +
  scale_color_manual(values = c("red", "blue", "green", "purple", "orange", "pink")) +
  geom_point(aes(color = factor(flesch_sentiment_cluster))) +
  scale_x_continuous(breaks = scales:: breaks_width(25), minor_breaks = NULL) +
  labs(y = "Flesch Reading Level",
       x = "Sentiment Score",
       title = "Inaugural Address Analysis",
       subtitle = "Flesch Reading Level vs Sentiment Score",
       color = "Cluster") +
  theme_minimal()

```

```{r}
#| label: Plotting-Flesch-Kincaid-vs-Sentiment

ggplot(inaug_speeches_master, aes(y = Flesch.Kincaid, x = sentiment)) +
  scale_color_manual(values = c("red", "blue", "green", "purple", "orange", "pink")) +
  geom_point(aes(color = factor(flesch_kin_sentiment_cluster))) +
  scale_x_continuous(breaks = scales:: breaks_width(25), minor_breaks = NULL) +
  labs(y = "Flesch-Kincaid Grade Level",
       x = "Sentiment Score",
        title = "Inaguaral Address Analysis",
       subtitle = "Flesch-Kincaid Grade Level vs Sentiment Score",
       color = "Cluster") +
  theme_minimal()


```


```{r}
#| label: Flesh-Kincaid-over-time

ggplot(inaug_speeches_master, aes(x = date, y = Flesch.Kincaid)) +
  geom_point() +
  geom_smooth( method = "loess", se = TRUE)+
  scale_x_continuous(breaks = scales:: breaks_width(25), minor_breaks = NULL) +
  geom_vline(xintercept = 1925, linetype = "dashed", color = "red") +
  geom_vline(xintercept = 1949, linetype = "dashed", color = "blue") +
  labs(title = "Inagural Speech Complexity Over Time",
    y = "Flesch-Kincaid Grade Level",
       x = "Year") +
  theme_minimal()

```

